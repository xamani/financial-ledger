# تسک‌ها و زمان‌بندی پروژه

این سند یک برش اجرایی از کارهای پروژه است تا برای برنامه‌ریزی و پیگیری (Tracking) استفاده شود.

## فرض‌ها

- هدف برنامه‌ریزی: تحویل یک نسخه MVP در ۱۰ ساعت
- خروجی‌ها به‌صورت Incremental تحویل می‌شوند (قابل اجرا/دمو در پایان هر فاز)
- زمان‌بندی‌ها تقریبی هستند و با توجه به تغییرات دامنه، ممکن است جابه‌جا شوند
- موارد خارج از دامنهٔ ۱۰ ساعت: پوشش تست‌های کامل، مستندسازی خیلی دقیق Swagger، و UX/طراحی پیشرفته

## فازها (پیشنهادی)

### فاز ۰ — آماده‌سازی زیرساخت (۰٫۵ ساعت)

- راه‌اندازی محیط Dev (Docker/بدون Docker) و تنظیم `.env`
- آماده‌سازی دیتابیس و اجرای `migrate:fresh --seed`
- بررسی اجرای سرویس‌ها و sanity check مسیرهای کلیدی

### فاز ۱ — دیتامدل و منطق دامنه (۲ ساعت)

- بازبینی/تثبیت مدل‌ها و روابط: `orders`, `wallets`, `transactions`
- تعریف/تثبیت وضعیت‌ها و نوع‌ها:
  - `order.status` (مثل `pending`, `completed`, `cancelled`)
  - `transaction.flow` (`in`, `out`)
  - `transaction.type` (مثل `platform_commission`, `withdrawal`, …)
- اعمال محدودیت‌ها/ایندکس‌های ضروری (در صورت نیاز)

### فاز ۲ — Orders + Ledger (۲ ساعت)

**Orders**
- `POST /api/orders` ساخت سفارش `pending`
- `GET /api/orders/{order}` نمایش تک سفارش
- `POST /api/orders/{order}/pay` ساخت لینک پرداخت mock
- `POST /api/orders/callback` نهایی‌سازی پرداخت + idempotency + قفل همزمانی با `lockForUpdate`

**Ledger / Financial**
- محاسبه Breakdown از طریق `App\Services\FinancialCalculatorService` (با env)
- اعمال سهم‌ها روی Walletها و ثبت Transactionهای مرتبط
- تضمین مدیریت پول به‌صورت minor-unit و بدون اعشار

### فاز ۳ — Transactions + Wallets (۱ ساعت)

**Transactions**
- `GET /api/transactions` لیست صفحه‌بندی + فیلترها
- `GET /api/transactions/{transaction}` نمایش تک تراکنش (با wallet)

**Wallets**
- `POST /api/wallets/withdraw` برداشت (کنترل موجودی، ثبت تراکنش out، تراکنش DB)

### فاز ۴ — گزارش‌ها (۱ ساعت)

- `GET /api/financial-reports` گزارش تجمیعی در بازه تاریخ (totals + by_type)
- `GET /api/financial-reports/chart` سری زمانی (day/month) سازگار با driverهای DB

### فاز ۵ — UI تست + جمع‌بندی (۳ ساعت)

- صفحه‌های create/list/show برای تست API زیر مسیر `/ui`
- فارسی‌سازی و نمایش اعداد/مبالغ با جداکننده هزارگان
- بهبود UX پایه (نمایش خطاهای اعتبارسنجی، پیام‌های وضعیت، لینک‌دهی بین صفحات)
- حداقل مستندسازی: به‌روزرسانی README + (در صورت زمان) اجرای `l5-swagger:generate`
- حداقل کیفیت: چند smoke test دستی + (در صورت زمان) یک/دو Feature test کلیدی

## زمان‌بندی نمونه (۱۰ ساعت)

- ساعت ۱: فاز ۰ (۰٫۵) + شروع فاز ۱ (۰٫۵)
- ساعت ۲: تکمیل فاز ۱ + شروع فاز ۲
- ساعت ۳–۵: فاز ۲
- ساعت ۶: فاز ۳
- ساعت ۷: فاز ۴
- ساعت ۸–۱۰: فاز ۵ + جمع‌بندی/رفع باگ‌های نهایی

## جمع‌بندی زمان‌ها (بدون تغییر برآورد فازها)

- فاز ۰: ۰٫۵ ساعت
- فاز ۱: ۲ ساعت
- فاز ۲: ۲ ساعت
- فاز ۳: ۱ ساعت
- فاز ۴: ۱ ساعت
- فاز ۵: ۳ ساعت
- جمع کل تسک‌ها: ۹٫۵ ساعت
- بافر/رزرو (برای دیباگ، ریزه‌کاری‌ها، جمع‌بندی): ۰٫۵ ساعت
- جمع کل برنامه: ۱۰ ساعت

## خروجی قابل تحویل هر فاز

- فاز ۰: پروژه قابل اجرا و دیتابیس آماده
- فاز ۱: اسکیمای تثبیت‌شده + مدل‌ها/روابط قابل اتکا
- فاز ۲: سفارش‌ها + جریان پرداخت mock + لاجیک دفترکل
- فاز ۳: API تراکنش‌ها + برداشت کیف‌پول
- فاز ۴: گزارش‌های تجمیعی و سری زمانی
- فاز ۵: UI تست قابل استفاده برای دمو + جمع‌بندی حداقلی مستندات/کیفیت
